{% extends "base.html" %}

{% block title %}Sources - Event Scraper{% endblock %}

{% block content %}
<div class="flex items-center justify-between mb-4">
    <h1>Sources</h1>
</div>

<div class="card">
    {% if source_stats %}
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>URL</th>
                <th>Scraper</th>
                <th>Events</th>
                <th>Letzter Scrape</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for item in source_stats %}
            <tr>
                <td><strong>{{ item.source.name }}</strong></td>
                <td class="text-sm">
                    <a href="{{ item.source.base_url }}" target="_blank" class="text-muted">
                        {{ item.source.base_url }}
                    </a>
                </td>
                <td class="text-sm text-muted">{{ item.source.scraper_class }}</td>
                <td>{{ item.events_count }}</td>
                <td>
                    {% if item.source.last_scraped_at %}
                    {{ item.source.last_scraped_at.strftime('%d.%m.%Y %H:%M') }}
                    {% else %}
                    <span class="text-muted">Nie</span>
                    {% endif %}
                </td>
                <td>
                    {% if item.source.is_active %}
                    <span class="badge badge-confirmed">Aktiv</span>
                    {% else %}
                    <span class="badge badge-ignored">Inaktiv</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-muted">Noch keine Sources vorhanden.</p>
    <p class="text-sm" style="margin-top: 0.5rem;">
        Führe zuerst einen Scraper aus:<br>
        <code style="background: var(--gray-100); padding: 0.25rem 0.5rem; border-radius: 4px;">
            docker compose run --rm scraper python -m src scrape mulfingen
        </code>
    </p>
    {% endif %}
</div>

<div class="card">
    <h2 class="card-title">Scraper ausführen</h2>
    <p class="text-muted mb-4">Nutze die API oder CLI um Scraper auszuführen:</p>

    <div style="background: var(--gray-900); color: var(--gray-100); padding: 1rem; border-radius: 6px; font-family: monospace; font-size: 0.875rem;">
        <div style="margin-bottom: 0.5rem; color: var(--gray-500);"># CLI</div>
        <div>docker compose run --rm scraper python -m src scrape mulfingen</div>
        <div style="margin-top: 1rem; margin-bottom: 0.5rem; color: var(--gray-500);"># API</div>
        <div>curl -X POST http://localhost:8000/api/scraper/run \</div>
        <div style="padding-left: 1rem;">-H "Content-Type: application/json" \</div>
        <div style="padding-left: 1rem;">-d '{"source_name": "mulfingen"}'</div>
    </div>
</div>
{% endblock %}
